(function($,undefined){var spring;$.spring=spring={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote], a[data-disable-with]",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not(button[type])",disableSelector:"input[data-disable-with], button[data-disable-with], textarea[data-disable-with]",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled",requiredInputSelector:"input[name][required]:not([disabled]),textarea[name][required]:not([disabled])",fileInputSelector:"input:file",linkDisableSelector:"a[data-disable-with]",fire:function(obj,name,data){var event=$.Event(name);obj.trigger(event,data);return event.result!==false;},confirm:function(message){return confirm(message);},ajax:function(options){return $.ajax(options);},handleRemote:function(element){var method,url,data,crossDomain=element.data("cross-domain")||null,dataType=element.data("type")||($.ajaxSettings&&$.ajaxSettings.dataType),options;if(spring.fire(element,"ajax:before")){if(element.is("form")){method=element.attr("method");url=element.attr("action");data=element.serializeArray();var button=element.data("ujs:submit-button");if(button){data.push(button);element.data("ujs:submit-button",null);}}else{if(element.is(spring.inputChangeSelector)){method=element.data("method");url=element.data("url");data=element.serialize();if(element.data("params")){data=data+"&"+element.data("params");}}else{method=element.data("method");url=element.attr("href");data=element.data("params")||null;}}options={type:method||"GET",data:data,dataType:dataType,crossDomain:crossDomain,beforeSend:function(xhr,settings){if(settings.dataType===undefined){xhr.setRequestHeader("accept","*/*;q=0.5, "+settings.accepts.script);}return spring.fire(element,"ajax:beforeSend",[xhr,settings]);},success:function(data,status,xhr){element.trigger("ajax:success",[data,status,xhr]);},complete:function(xhr,status){element.trigger("ajax:complete",[xhr,status]);},error:function(xhr,status,error){element.trigger("ajax:error",[xhr,status,error]);}};if(url){options.url=url;}return spring.ajax(options);}else{return false;}},handleMethod:function(link){var href=link.attr("href"),method=link.data("method"),target=link.attr("target"),form=$('<form method="post" action="'+href+'"></form>'),metadata_input='<input name="_method" value="'+method+'" type="hidden" />';if(target){form.attr("target",target);}form.hide().append(metadata_input).appendTo("body");form.submit();},disableFormElements:function(form){form.find(spring.disableSelector).each(function(){var element=$(this),method=element.is("button")?"html":"val";element.data("ujs:enable-with",element[method]());element[method](element.data("disable-with"));element.prop("disabled",true);});},enableFormElements:function(form){form.find(spring.enableSelector).each(function(){var element=$(this),method=element.is("button")?"html":"val";if(element.data("ujs:enable-with")){element[method](element.data("ujs:enable-with"));}element.prop("disabled",false);});},allowAction:function(element){var message=element.data("confirm"),answer=false,callback;if(!message){return true;}if(spring.fire(element,"confirm")){answer=spring.confirm(message);callback=spring.fire(element,"confirm:complete",[answer]);}return answer&&callback;},blankInputs:function(form,specifiedSelector,nonBlank){var inputs=$(),input,selector=specifiedSelector||"input,textarea";form.find(selector).each(function(){input=$(this);if(nonBlank?input.val():!input.val()){inputs=inputs.add(input);}});return inputs.length?inputs:false;},nonBlankInputs:function(form,specifiedSelector){return spring.blankInputs(form,specifiedSelector,true);},stopEverything:function(e){$(e.target).trigger("ujs:everythingStopped");e.stopImmediatePropagation();return false;},callFormSubmitBindings:function(form,event){var events=form.data("events"),continuePropagation=true;if(events!==undefined&&events.submit!==undefined){$.each(events.submit,function(i,obj){if(typeof obj.handler==="function"){return continuePropagation=obj.handler(event);}});}return continuePropagation;},disableElement:function(element){element.data("ujs:enable-with",element.html());element.html(element.data("disable-with"));element.bind("click.springDisable",function(e){return spring.stopEverything(e);});},enableElement:function(element){if(element.data("ujs:enable-with")!==undefined){element.html(element.data("ujs:enable-with"));element.data("ujs:enable-with",false);}element.unbind("click.springDisable");}};$(document).delegate(spring.linkDisableSelector,"ajax:complete",function(){spring.enableElement($(this));});$(document).delegate(spring.linkClickSelector,"click.spring",function(e){var link=$(this),method=link.data("method"),data=link.data("params");if(!spring.allowAction(link)){return spring.stopEverything(e);}if(link.is(spring.linkDisableSelector)){spring.disableElement(link);}if(link.data("remote")!==undefined){if((e.metaKey||e.ctrlKey)&&(!method||method==="GET")&&!data){return true;}if(spring.handleRemote(link)===false){spring.enableElement(link);}return false;}else{if(link.data("method")){spring.handleMethod(link);return false;}}});$(document).delegate(spring.inputChangeSelector,"change.spring",function(e){var link=$(this);if(!spring.allowAction(link)){return spring.stopEverything(e);}spring.handleRemote(link);return false;});$(document).delegate(spring.formSubmitSelector,"submit.spring",function(e){var form=$(this),remote=form.data("remote")!==undefined,blankRequiredInputs=spring.blankInputs(form,spring.requiredInputSelector),nonBlankFileInputs=spring.nonBlankInputs(form,spring.fileInputSelector);if(!spring.allowAction(form)){return spring.stopEverything(e);}if(blankRequiredInputs&&form.attr("novalidate")==undefined&&spring.fire(form,"ajax:aborted:required",[blankRequiredInputs])){return spring.stopEverything(e);}if(remote){if(nonBlankFileInputs){return spring.fire(form,"ajax:aborted:file",[nonBlankFileInputs]);}if(!$.support.submitBubbles&&$().jquery<"1.7"&&spring.callFormSubmitBindings(form,e)===false){return spring.stopEverything(e);}spring.handleRemote(form);return false;}else{setTimeout(function(){spring.disableFormElements(form);},13);}});$(document).delegate(spring.formInputClickSelector,"click.spring",function(event){var button=$(this);if(!spring.allowAction(button)){return spring.stopEverything(event);}var name=button.attr("name"),data=name?{name:name,value:button.val()}:null;button.closest("form").data("ujs:submit-button",data);});$(document).delegate(spring.formSubmitSelector,"ajax:beforeSend.spring",function(event){if(this==event.target){spring.disableFormElements($(this));}});$(document).delegate(spring.formSubmitSelector,"ajax:complete.spring",function(event){if(this==event.target){spring.enableFormElements($(this));}});})(jQuery);